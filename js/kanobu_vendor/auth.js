/**
 * Auth template script.
 * Sets some strings and methods, for managing visual actions
 */
var Auth={user:null,notifTimeout:null,animationInProgress:false,msgAuth:"Войдите на сайт, чтобы <%= action %>",msgNotConfirmed:"Подтвердите свой email, чтобы <%= action %>",msgBanned:'Вас временно забанили. <a href="mailto:kanobu@kanobu.ru">Вопросы?</a>',required:function(e,t,n){n=typeof n=="undefined"?false:n;if(typeof t=="undefined"){Auth.notify(e);return r.hasAccess(n)}var r=this;return function(){if(r.hasAccess(n)){return t.apply(this,arguments)}else{var i=arguments[0];if(typeof i.preventDefault=="function"){i.preventDefault()}Auth.notify(e)}}},confirmed:function(e,t){return this.required(e,t,true)},hasAccess:function(e){e=typeof e=="undefined"?true:e;return this.user&&!this.user.banned&&(!e||e&&this.user.confirmed)},notify:function(e){var t=this.getMessage(e);if(this.user){$(".profileItem").notify(t,"bottom")}else{$(".anonymous .loginItem").notify(t,"bottom")}},getMessage:function(e){var t;if(!this.user)t=this.msgAuth;else if(!this.user.confirmed)t=this.msgNotConfirmed;else if(this.user.banned)t=this.msgBanned;else t="";return _.template(t,{action:e})}};(function(e){e.fn.authRequired=function(){if(!Auth.hasAccess()){this.each(function(){var t=e(this).data("auth-action");e(this).disable().click(function(){Auth.notify(t)})})}};e.fn.disable=function(){var t=e();this.each(function(n,r){var i=e(r).css("opacity",.4);if(i.css("position")!="absolute"){i.css("position","relative")}var s=i.wrapAll(e("<div>").css({position:i.css("position"),left:i.css("left"),top:i.css("top"),right:i.css("right"),bottom:i.css("bottom"),width:i.outerWidth(true),height:i.outerHeight(true),"float":i.css("float")})).parent();var o=e("<div>").css({position:"absolute",left:0,top:0,width:"100%",height:"100%",zIndex:100});o.appendTo(s);t=t.add(o)});return t}})(jQuery);$(function(){var e=e||"";if(typeof knbApi!=="undefined"){$(".auth_trigger").on("click",function(t){t.preventDefault();knbApi.showAuth({c_app_id:e,opened:true,iframe:true})});$(".logout_trigger").on("click",function(e){e.preventDefault();knbApi.authLogout()})}})